---
import "../styles/global.css";

const { title = "Shooting Quarterly" } = Astro.props;
const pathname = Astro.url.pathname;

/** Normalize paths for consistent matching */
const normalize = (p: string) =>
  p !== "/" && p.endsWith("/") ? p.slice(0, -1) : p;

/** Match exact path and section roots */
const isCurrent = (href: string): boolean => {
  const path = normalize(pathname);
  const target = normalize(href);
  if (target === "/") return path === "/";
  return path === target || path.startsWith(`${target}/`);
};

/** Navigation configuration */
const navItems = [
  { href: "/", label: "Home" },
  { href: "/blog", label: "Blog" },
  { href: "/book", label: "Book" },
  { href: "/about", label: "About" },
  { href: "/contact", label: "Contact" },
];

/** Generate nav classes using standard Tailwind classes */
const getNavClasses = (href: string) => {
  const baseClasses =
    "text-zinc-600 hover:text-orange-600 focus:text-orange-600 transition-colors duration-200 hover:underline";
  const activeClasses = "text-orange-600 font-medium";

  return isCurrent(href) ? `${baseClasses} ${activeClasses}` : baseClasses;
};

/** Set aria-current for active links */
const getAriaCurrent = (href: string) => (isCurrent(href) ? "page" : undefined);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="description"
      content="Shooting Quarterly - Shooting is Soothing! Building a connected sport shooting community."
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Optimized font loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <title>{title} — Shooting Quarterly</title>
  </head>

  <body class="min-h-screen flex flex-col bg-zinc-100 text-black font-sans">
    <!-- Header with Navigation -->
    <header class="bg-white shadow-md border-b border-zinc-200">
      <div
        class="container mx-auto px-4 py-4 flex items-center justify-between"
      >
        <!-- Logo/Brand -->
        <a
          href="/"
          class="text-xl font-bold text-black hover:text-orange-600 transition-colors duration-200"
        >
          Shooting Quarterly
        </a>

        <!-- Mobile Menu Button -->
        <button
          class="sm:hidden text-zinc-600 hover:text-orange-600 transition-colors duration-200"
          id="mobile-menu-button"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>

        <!-- Desktop Navigation -->
        <nav
          class="hidden sm:flex space-x-6 text-sm"
          aria-label="Main navigation"
        >
          {
            navItems.map(({ href, label }) => (
              <a
                href={href}
                class={getNavClasses(href)}
                aria-current={getAriaCurrent(href)}
              >
                {label}
              </a>
            ))
          }
        </nav>
      </div>

      <!-- Mobile Navigation -->
      <div
        id="mobile-menu"
        class="sm:hidden hidden bg-white border-t border-zinc-200"
        role="navigation"
        aria-label="Mobile navigation"
      >
        <div class="px-4 py-3 space-y-3">
          {
            navItems.map(({ href, label }) => (
              <a
                href={href}
                class={`block text-sm ${getNavClasses(href)}`}
                aria-current={getAriaCurrent(href)}
              >
                {label}
              </a>
            ))
          }
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 container mx-auto px-4 py-8">
      <slot />
    </main>

    <!-- Footer -->
    <footer
      class="bg-zinc-100 text-zinc-600 text-center text-xs py-4 border-t border-zinc-200"
    >
      <p>
        © {new Date().getFullYear()} Shooting Quarterly - Shooting is Soothing!
      </p>
    </footer>

    <!-- Minimal JavaScript for Mobile Menu Only -->
    <script is:inline>
      // Mobile menu toggle - NO navigation state management
      const menuButton = document.getElementById("mobile-menu-button");
      const mobileMenu = document.getElementById("mobile-menu");

      if (menuButton && mobileMenu) {
        menuButton.addEventListener("click", () => {
          const isExpanded =
            menuButton.getAttribute("aria-expanded") === "true";

          // Toggle menu visibility
          mobileMenu.classList.toggle("hidden");

          // Update aria-expanded
          menuButton.setAttribute("aria-expanded", (!isExpanded).toString());
        });

        // Close menu when clicking a link
        mobileMenu.querySelectorAll("a").forEach((link) => {
          link.addEventListener("click", () => {
            mobileMenu.classList.add("hidden");
            menuButton.setAttribute("aria-expanded", "false");
          });
        });

        // Close menu on escape key
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && !mobileMenu.classList.contains("hidden")) {
            mobileMenu.classList.add("hidden");
            menuButton.setAttribute("aria-expanded", "false");
            menuButton.focus();
          }
        });
      }
    </script>
  </body>
</html>
